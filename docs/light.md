---
layout: default
title: Controlling the light
nav_order: 1
parent: Custom Intents
---

<details close markdown="block">
  <summary>
    Content
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

# Controlling the light

## Flow features

- Turn the lights on and off
- Change the color temperature
- Change the brightness
- Control the light in different rooms
- Feedback on success

![Here is an image of the complete flow.](../assets/flow_light.png).

<details close markdown="block">
  <summary>
    JSON for complete flow.
  </summary>

```json
[
   {
      "id":"bebfde10.84dc9",
      "type":"tab",
      "label":"Flow 1",
      "disabled":false,
      "info":""
   },
   {
      "id":"5c26e7f1.bde118",
      "type":"websocket in",
      "z":"bebfde10.84dc9",
      "name":"rhasspy",
      "server":"f444d71d.abe328",
      "client":"",
      "x":70,
      "y":20,
      "wires":[
         [
            "813a34f1.8b83a8",
            "984b23c9.bd447"
         ]
      ]
   },
   {
      "id":"984b23c9.bd447",
      "type":"debug",
      "z":"bebfde10.84dc9",
      "name":"debug",
      "active":true,
      "tosidebar":true,
      "console":false,
      "tostatus":false,
      "complete":"true",
      "targetType":"full",
      "statusVal":"",
      "statusType":"auto",
      "x":390,
      "y":20,
      "wires":[
      ]
   },
   {
      "id":"813a34f1.8b83a8",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"intent_handling",
      "property":"intent.name",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"GetTime",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"Void",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"ChangeBrightness",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"ChangeTemp",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"SetLight",
            "vt":"str"
         }
      ],
      "checkall":"false",
      "repair":false,
      "outputs":5,
      "x":200,
      "y":220,
      "wires":[
         [
            "f23ef122.354de"
         ],
         [
            "c919818c.f2d21"
         ],
         [
            "7bcad998.0d9e88"
         ],
         [
            "9c670c0e.7ee14"
         ],
         [
            "177551ab.e1323e"
         ]
      ]
   },
   {
      "id":"fc53168a.ea73e8",
      "type":"mqtt out",
      "z":"bebfde10.84dc9",
      "name":"mqqt set Lampe",
      "topic":"zigbee2mqtt/Lampe/set",
      "qos":"",
      "retain":"",
      "broker":"e4b2ae7a.7f898",
      "x":1180,
      "y":380,
      "wires":[
      ]
   },
   {
      "id":"c8adb3c1.51615",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"turn off",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"state\": \"OFF\",\n  \"transition\": 2\n}",
      "output":"json",
      "x":890,
      "y":540,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"bb85354c.f425a8",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"turn on",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"state\": \"ON\",\n  \"color_temp\": 155,\n  \"transition\": 2\n}",
      "output":"json",
      "x":900,
      "y":500,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"e11a86b3.8cb3e8",
      "type":"http request",
      "z":"bebfde10.84dc9",
      "name":"TTS",
      "method":"POST",
      "ret":"txt",
      "paytoqs":"ignore",
      "url":"http://raspberrypi:12101/api/text-to-speech",
      "tls":"",
      "persist":false,
      "proxy":"",
      "authType":"",
      "x":1290,
      "y":200,
      "wires":[
         [
            
         ]
      ]
   },
   {
      "id":"c919818c.f2d21",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"Nicht verstanden",
      "field":"payload",
      "fieldType":"msg",
      "format":"handlebars",
      "syntax":"plain",
      "template":"Das habe ich leider nicht verstanden",
      "output":"str",
      "x":690,
      "y":200,
      "wires":[
         [
            "e11a86b3.8cb3e8"
         ]
      ]
   },
   {
      "id":"f23ef122.354de",
      "type":"function",
      "z":"bebfde10.84dc9",
      "name":"uhrzeit",
      "func":"var today = new Date();\n\nmsg.payload = \"Es ist \" + (today.getHours() + 1) + \" Uhr \" + today.getMinutes();\n\n\nreturn msg;",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":650,
      "y":160,
      "wires":[
         [
            "e11a86b3.8cb3e8"
         ]
      ]
   },
   {
      "id":"2597e531.1d041a",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"BrightnessLevel",
      "property":"slots.brightness",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"niedrig",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"mittel",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"hoch",
            "vt":"str"
         }
      ],
      "checkall":"false",
      "repair":false,
      "outputs":3,
      "x":720,
      "y":340,
      "wires":[
         [
            "95971454.cda018"
         ],
         [
            "535771c7.b6595"
         ],
         [
            "f02afc5a.c33c1"
         ]
      ]
   },
   {
      "id":"95971454.cda018",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"niedrig",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"brightness\": 30\n}",
      "output":"json",
      "x":890,
      "y":300,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"535771c7.b6595",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"mittel",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"brightness\": 130\n}",
      "output":"json",
      "x":890,
      "y":340,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"f02afc5a.c33c1",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"hoch",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"brightness\": 255\n}",
      "output":"json",
      "x":890,
      "y":380,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"d8a55349.360ab",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"an/aus",
      "property":"slots.state",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"an",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"aus",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":2,
      "x":690,
      "y":520,
      "wires":[
         [
            "bb85354c.f425a8"
         ],
         [
            "c8adb3c1.51615"
         ]
      ]
   },
   {
      "id":"cc9671f.cb6dc9",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"ColorTemp",
      "property":"slots.temp",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"warm",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"kalt",
            "vt":"str"
         }
      ],
      "checkall":"false",
      "repair":false,
      "outputs":2,
      "x":710,
      "y":440,
      "wires":[
         [
            "ba345e6.bcaafa"
         ],
         [
            "6e2f3929.456268"
         ]
      ]
   },
   {
      "id":"ba345e6.bcaafa",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"warm",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"color_temp\": 400\n}",
      "output":"json",
      "x":890,
      "y":420,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"6e2f3929.456268",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"kalt",
      "field":"payload",
      "fieldType":"msg",
      "format":"json",
      "syntax":"plain",
      "template":"{\n  \"color_temp\": 50\n}",
      "output":"json",
      "x":890,
      "y":460,
      "wires":[
         [
            "fc53168a.ea73e8",
            "904eb0a8.829d3"
         ]
      ]
   },
   {
      "id":"177551ab.e1323e",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"Raum erkennen",
      "property":"slots.room",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"wohnzimmer",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"schlafzimmer",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":2,
      "x":520,
      "y":520,
      "wires":[
         [
            "d8a55349.360ab"
         ],
         [
            "935a3a82.50c5e8"
         ]
      ]
   },
   {
      "id":"9c670c0e.7ee14",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"Raum erkennen",
      "property":"slots.room",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"wohnzimmer",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"schlafzimmer",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":2,
      "x":520,
      "y":440,
      "wires":[
         [
            "cc9671f.cb6dc9"
         ],
         [
            "935a3a82.50c5e8"
         ]
      ]
   },
   {
      "id":"7bcad998.0d9e88",
      "type":"switch",
      "z":"bebfde10.84dc9",
      "name":"Raum erkennen",
      "property":"slots.room",
      "propertyType":"msg",
      "rules":[
         {
            "t":"eq",
            "v":"wohnzimmer",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"schlafzimmer",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":2,
      "x":520,
      "y":340,
      "wires":[
         [
            "2597e531.1d041a"
         ],
         [
            "935a3a82.50c5e8"
         ]
      ]
   },
   {
      "id":"935a3a82.50c5e8",
      "type":"debug",
      "z":"bebfde10.84dc9",
      "name":"Debug f√ºr Schlafzimmer",
      "active":true,
      "tosidebar":true,
      "console":false,
      "tostatus":false,
      "complete":"true",
      "targetType":"full",
      "statusVal":"",
      "statusType":"auto",
      "x":770,
      "y":700,
      "wires":[
         
      ]
   },
   {
      "id":"904eb0a8.829d3",
      "type":"template",
      "z":"bebfde10.84dc9",
      "name":"Erledigt",
      "field":"payload",
      "fieldType":"msg",
      "format":"handlebars",
      "syntax":"mustache",
      "template":"Erledigt",
      "output":"str",
      "x":1060,
      "y":240,
      "wires":[
         [
            "e11a86b3.8cb3e8"
         ]
      ]
   },
   {
      "id":"f444d71d.abe328",
      "type":"websocket-listener",
      "path":"ws://raspberrypi:12101/api/events/intent",
      "wholemsg":"true"
   },
   {
      "id":"e4b2ae7a.7f898",
      "type":"mqtt-broker",
      "name":"rhasspy mqtt",
      "broker":"raspberrypi",
      "port":"12183",
      "clientid":"",
      "usetls":false,
      "compatmode":false,
      "keepalive":"60",
      "cleansession":true,
      "birthTopic":"",
      "birthQos":"0",
      "birthPayload":"",
      "closeTopic":"",
      "closeQos":"0",
      "closePayload":"",
      "willTopic":"",
      "willQos":"0",
      "willPayload":""
   }
]
```
</details>